In this lab, we will work on functions. Just like we did in the lecture, make use of the terraform console command through this lab to test different functions, and see how they transform and manipulate values.



What value does floor(10.9) produce?
==>  terraform console 
> floor(10.9)
10
What value does title("user-generated password file") produce?
==> > title("user-generated password file")
"User-Generated Password File"
Which type of variable does the function lookup working with?
==> map
Navigate to the configuration directory /root/terraform-projects/project-sonic. Here, we have a number of variables declared in the variables.tf file.
What type of variable is cloud_users?
==> ## variables.tf
variable "region" {
  default = "ca-central-1"
}
variable "cloud_users" {
     type = string
     default = "andrew:ken:faraz:mutsumi:peter:steve:braja"
  
}
variable "bucket" {
  default = "sonic-media"
  
}

variable "media" {
  type = set(string)
  default = [ 
    "/media/tails.jpg",
    "/media/eggman.jpg",
    "/media/ultrasonic.jpg",
    "/media/knuckles.jpg",
    "/media/shadow.jpg",
      ]
  
}
variable "sf" {
  type = list
  default = [
    "ryu",
    "ken",
    "akuma",
    "seth",
    "zangief",
    "poison",
    "gen",
    "oni",
    "thawk",
    "fang",
    "rashid",
    "birdie",
    "sagat",
    "bison",
    "cammy",
    "chun-li",
    "balrog",
    "cody",
    "rolento",
    "ibuki"

  ]
}

==> string

This variable contains the developers' names for project-sonic with the names separated by a :.
Using this variable and the count meta-argument, create IAM users for all developers. Write the resource block and name it as a cloud in the main.tf file.


Convert this variable from a string to a list.
Do not change the variable defined in variables.tf.


When ready, create the users by running a terraform init, plan, apply
==> ## main.tf
resource "aws_iam_user" "cloud" {
     name = split(":",var.cloud_users)[count.index]
     count = length(split(":",var.cloud_users))

}
exple
txt = "welcome to the jungle"

x = txt.split()

print(x)
out
['welcome', 'to', 'the', 'jungle']

What is the name of the IAM User that is created at the Index 6, of the IAM User at address aws_iam_user.cloud ?

Use the terraform console to find out.
==> echo 'aws_iam_user.cloud[6]' | terraform console 
{
  "arn" = "arn:aws:iam::000000000000:user/braja"
  "force_destroy" = false
  "id" = "braja"
  "name" = "braja"
  "path" = "/"
  "permissions_boundary" = tostring(null)
  "tags" = tomap(null) /* of string */
  "tags_all" = tomap({})
  "unique_id" = "y79shonhzyjc5zoknalv"
}

Locate the index of the element called oni in the variable called sf.
==> Use terraform console and check index(var.sf,"oni") OR to use a one liner:
echo "index(var.sf,\"oni\")" | terraform console
==> ❯ terraform console 
> index(var.sf,"oni")
7

What type is the variable called media?
==> Inspect the variables.tf file and look at the type argument for media.
set(string)

We have now, updated the main.tf in this configuration directory and added a new resource block to create a S3 bucket called sonic-media.

Create an additional resource called upload_sonic_media to upload the files listed in the variable called media to this bucket.

Use the following specifications:

Use the for_each meta-argument to upload all the elements of the media variable.
bucket: Use reference expression to the bucket sonic-media.
source: Each element in the variable called media.
key: Should be the name of the files being uploaded (minus the /root). For an example, eggman.jpg, shadow.jpg e.t.c.

Do not alter the variables!
When ready, run terraform apply to create the bucket and upload the items.
==> Use substr with the each.value expression. Choose 7 as the offset and a length greater than the longest element.

==> resource "aws_s3_object" "upload_sonic_media" {
     bucket = aws_s3_bucket.sonic_media.id
     key =  substr(each.value, 7, 20)
     source = each.value
     for_each = var.media 

}

For the final question, navigate to the configuration directory called /root/terraform-projects/project-mario.

We have an empty main.tf file here. The provider and variables have already been configured for you.


What is the value of the variable called small?
==> ## variable.tf
variable "region" {
    default = "us-east-1"
}
variable  "name" {
    type = string
}
variable "ami" {
    type = string
    default = "ami-09331245601cf"
}
variable "small" {
    type = string
    default = "t2.nano"
}
variable "large" {
    type = string
    default = "t2.2xlarge"
}

What is the current value for the variable called name?
==> undefined

Create an EC2 Instance with the resource name mario_servers.

Use the following specifications:

AMI: Use variable called ami.


Tags: Create a tag with key Name and value set to the variable called name.


Instance_type: Use a conditional expression so that - If the instance is created with a tag Name = "tiny", it should use the variable called small else the variable called large.


We will supply the variable called name using the -var command line flag.

==> resource "aws_instance" "mario_servers" {
     ami = var.ami
     instance_type = var.name == "tiny" ? var.small : var.large
     tags = {
          Name = var.name

     }

}




https://www.cloudbolt.io/terraform-best-practices/terraform-lookup/








































































